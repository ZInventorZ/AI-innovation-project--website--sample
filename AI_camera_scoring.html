<<<<<<< HEAD
<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>AI Innovation Project - Equipment</title>
	<link rel="stylesheet" href="style.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>

<body>
	<!-- Top-left back button: tries history.back(), falls back to index.html -->
	<a class="back-btn" href="index.html" onclick="if(history.length>1){history.back();return false;}">‚Üê Back</a>
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-bottom">
    <div class="container-fluid">
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="nav nav-pills ms-auto" role="tablist">
          <li class="nav-item"><a class="nav-link active" href="index.html"><span class="nav-icon">üìà</span>History</a></li>
          <li class="nav-item"><a class="nav-link" href="AI_Coach.html"><span class="nav-icon">ü§ñ</span>AI Coach</a></li>
          <li class="nav-item"><a class="nav-link" href="equipment.html"><span class="nav-icon">üèπ</span>Equipment</a></li>
          <li class="nav-item"><a class="nav-link" href="statistics.html"><span class="nav-icon">üìä</span>Statistics</a></li>
          <li class="nav-item"><a class="nav-link" href="competition.html"><span class="nav-icon">üèÜ</span>Competition</a></li>
          <li class="nav-item"><a class="nav-link" href="menu.html"><span class="nav-icon">‚ò∞</span>Menu</a></li>
        </ul>
      </div>
    </div>
  </nav>

	<header class="page-header">
		<div class="container">
			<img src="images/AIchery_logo_full_sized.png" alt="AIchery Logo" style="max-width: 150px; height: auto;">
		</div>
	</header>

	<main class="site-main container py-4">
		<h2>Equipment</h2>
		<p>Equipment list and management.</p>

		<p>
			<button id="manageEq" class="btn btn-primary">Manage Current Equipment</button>
			<button id="addSetup" class="btn btn-outline-primary ms-2">Add Equipment Setup</button>
			<button id="manageArrows" class="btn btn-outline-secondary ms-2">Manage Arrows</button>
		</p>

		<div id="eqArea" class="card p-3" style="display:none;">
			<div class="row g-2">
				<div class="col-md-6"><label class="form-label">Bow</label><input id="eq_bow" class="form-control"></div>
				<div class="col-md-6"><label class="form-label">Sight</label><input id="eq_sight" class="form-control"></div>
								<div class="col-md-6">
									<label class="form-label">Arrows</label>
									<input id="eq_arrows" class="form-control" placeholder="Arrow model or notes">
									<select id="eq_arrows_select" class="form-select mt-2"><option value="">Choose arrow model‚Ä¶</option></select>
								</div>
				<div class="col-md-6"><label class="form-label">Release</label><input id="eq_release" class="form-control"></div>
				<div class="col-md-12"><label class="form-label">Notes</label><input id="eq_notes" class="form-control"></div>
			</div>
			<div class="mt-3"><button id="eq_save" class="btn btn-success">Save Current Equipment</button> <span id="eq_status" class="ms-2"></span></div>
		</div>

		<div id="setupArea" class="card p-3 mt-3">
			<div class="d-flex justify-content-between align-items-center">
				<h4 class="mb-0">Equipment Setups</h4>
				<small class="text-muted">Create named setups and reuse in sessions</small>
			</div>
			<div id="setupForm" style="display:none;" class="mt-3">
				<div class="row g-2">
					<div class="col-md-6"><label class="form-label">Setup Name</label><input id="setup_name" class="form-control"></div>
					<div class="col-md-6"><label class="form-label">Bow</label><input id="setup_bow" class="form-control"></div>
					<div class="col-md-6"><label class="form-label">Sight</label><input id="setup_sight" class="form-control"></div>
										<div class="col-md-6">
											<label class="form-label">Arrows</label>
											<input id="setup_arrows" class="form-control" placeholder="Arrow model or notes">
											<select id="setup_arrows_select" class="form-select mt-2"><option value="">Choose arrow model‚Ä¶</option></select>
										</div>
					<div class="col-md-6"><label class="form-label">Release</label><input id="setup_release" class="form-control"></div>
					<div class="col-md-12"><label class="form-label">Notes</label><input id="setup_notes" class="form-control"></div>
				</div>
				<div class="mt-3"><button id="setup_save" class="btn btn-primary">Save Setup</button> <button id="setup_cancel" class="btn btn-link">Cancel</button></div>
			</div>

			<div id="setupsList" class="mt-3"></div>
		</div>

		<!-- Arrows management area -->
		<div id="arrowsArea" class="card p-3 mt-3" style="display:none;">
			<div class="d-flex justify-content-between align-items-center">
				<h4 class="mb-0">Arrows</h4>
				<small class="text-muted">Manage arrow models</small>
			</div>
			<div class="mt-3">
				<div id="arrow_list"></div>
				<div class="row g-2 mt-3">
					<div class="col-md-4"><input id="arrow_name" class="form-control" placeholder="Model name"></div>
					<div class="col-md-2"><input id="arrow_spine" class="form-control" placeholder="Spine"></div>
					<div class="col-md-2"><input id="arrow_vanes" class="form-control" placeholder="Vanes"></div>
					<div class="col-md-2"><input id="arrow_dia" class="form-control" placeholder="Dia (mm)"></div>
					<div class="col-md-2"><button id="arrow_save" class="btn btn-primary w-100">Add Arrow</button></div>
				</div>
			</div>
		</div>
	</main>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<script>
	(function(){
		function getEq(){return JSON.parse(localStorage.getItem('equipment')||'{}');}
		function saveEq(o){localStorage.setItem('equipment',JSON.stringify(o));}
		function getSetups(){return JSON.parse(localStorage.getItem('equipmentSetups')||'[]');}
		function saveSetups(a){localStorage.setItem('equipmentSetups',JSON.stringify(a));}

		const btn=document.getElementById('manageEq');
		const area=document.getElementById('eqArea');
		const addSetupBtn=document.getElementById('addSetup');
		const setupForm=document.getElementById('setupForm');
		const setupsList=document.getElementById('setupsList');

		function renderSetups(){
			const arr=getSetups();
			setupsList.innerHTML='';
			if(!arr.length){setupsList.innerHTML='<div class="alert alert-secondary">No setups yet.</div>';return}
			arr.slice().reverse().forEach(s=>{
				const div=document.createElement('div'); div.className='border rounded p-2 mb-2';
				div.innerHTML=`<div class="d-flex justify-content-between"><strong>${s.name}</strong><div><button class="btn btn-sm btn-outline-secondary ms-1" data-id="${s.id}" data-act="use">Use</button><button class="btn btn-sm btn-outline-danger ms-1" data-id="${s.id}" data-act="del">Delete</button></div></div>
				<div class="small text-muted mt-1">Bow: ${s.bow||'-'} ‚Ä¢ Sight: ${s.sight||'-'} ‚Ä¢ Release: ${s.release||'-'} ‚Ä¢ Arrows: ${s.arrows||'-'}</div>`;
				setupsList.appendChild(div);
			});
		}

		btn.addEventListener('click',()=>{
			area.style.display= area.style.display==='none'? 'block':'none';
			if(area.style.display==='block'){
				const eq=getEq();
				document.getElementById('eq_bow').value=eq.bow||'';
				document.getElementById('eq_sight').value=eq.sight||'';
				document.getElementById('eq_arrows').value=eq.arrows||'';
				document.getElementById('eq_release').value=eq.release||'';
				document.getElementById('eq_notes').value=eq.notes||'';
			}
		});

		document.getElementById('eq_save').addEventListener('click',()=>{
			const o={
				bow:document.getElementById('eq_bow').value,
				sight:document.getElementById('eq_sight').value,
				arrows:document.getElementById('eq_arrows').value,
				release:document.getElementById('eq_release').value,
				notes:document.getElementById('eq_notes').value
			};
			saveEq(o);
			document.getElementById('eq_status').textContent='Saved ‚úì';
			setTimeout(()=>document.getElementById('eq_status').textContent='',1500);
			renderSetups();
		});

		addSetupBtn.addEventListener('click',()=>{ setupForm.style.display= setupForm.style.display==='none' ? 'block' : 'none'; });
		document.getElementById('setup_cancel').addEventListener('click',()=>{ setupForm.style.display='none'; });

		document.getElementById('setup_save').addEventListener('click',()=>{
			const s={ id: Date.now(), name: document.getElementById('setup_name').value||('Setup '+Date.now()), bow:document.getElementById('setup_bow').value, sight:document.getElementById('setup_sight').value, arrows:document.getElementById('setup_arrows').value, release:document.getElementById('setup_release').value, notes:document.getElementById('setup_notes').value };
			const arr=getSetups(); arr.push(s); saveSetups(arr);
			setupForm.style.display='none';
			renderSetups();
		});

		setupsList.addEventListener('click', (ev)=>{
			const btn = ev.target.closest('button'); if(!btn) return; const id=Number(btn.getAttribute('data-id')); const act=btn.getAttribute('data-act');
			if(act==='del'){
				let arr=getSetups(); arr=arr.filter(x=>x.id!==id); saveSetups(arr); renderSetups();
			}
			if(act==='use'){
				const arr=getSetups(); const s=arr.find(x=>x.id===id); if(!s) return;
				// copy into current equipment and save
				document.getElementById('eq_bow').value=s.bow||'';
				document.getElementById('eq_sight').value=s.sight||'';
				document.getElementById('eq_arrows').value=s.arrows||'';
				document.getElementById('eq_release').value=s.release||'';
				document.getElementById('eq_notes').value=s.notes||'';
				saveEq({bow:s.bow,sight:s.sight,arrows:s.arrows,release:s.release,notes:s.notes});
				document.getElementById('eq_status').textContent='Loaded into current equipment';
				setTimeout(()=>document.getElementById('eq_status').textContent='',1500);
			}
		});

		renderSetups();

		// --- Arrows management ---
		function getArrows(){return JSON.parse(localStorage.getItem('arrows')||'[]');}
		function saveArrows(a){localStorage.setItem('arrows',JSON.stringify(a));}

		function renderArrows(){
			const list=getArrows(); const container=document.getElementById('arrow_list'); container.innerHTML='';
			if(!list.length){ container.innerHTML='<div class="alert alert-secondary">No arrow models yet.</div>'; return; }
			list.slice().reverse().forEach(a=>{
				const d=document.createElement('div'); d.className='border rounded p-2 mb-2';
				d.innerHTML = `<div class="d-flex justify-content-between"><strong>${a.name}</strong><div><button class="btn btn-sm btn-outline-secondary ms-1" data-id="${a.id}" data-act="use">Select</button><button class="btn btn-sm btn-outline-danger ms-1" data-id="${a.id}" data-act="del">Delete</button></div></div><div class="small text-muted mt-1">Spine: ${a.spine||'-'} ‚Ä¢ Vanes: ${a.vanes||'-'} ‚Ä¢ Dia: ${a.dia||'-'}</div>`;
				container.appendChild(d);
			});
			populateArrowSelects();
		}

		document.getElementById('manageArrows').addEventListener('click',()=>{
			const ar=document.getElementById('arrowsArea'); ar.style.display = ar.style.display==='none' ? 'block' : 'none'; if(ar.style.display==='block') renderArrows();
		});

		document.getElementById('arrow_save').addEventListener('click',()=>{
			const name=document.getElementById('arrow_name').value.trim(); if(!name) return alert('Enter a name');
			const a={ id: Date.now(), name, spine:document.getElementById('arrow_spine').value.trim(), vanes:document.getElementById('arrow_vanes').value.trim(), dia:document.getElementById('arrow_dia').value.trim() };
			const arr=getArrows(); arr.push(a); saveArrows(arr); document.getElementById('arrow_name').value=''; document.getElementById('arrow_spine').value=''; document.getElementById('arrow_vanes').value=''; document.getElementById('arrow_dia').value=''; renderArrows();
		});

		document.getElementById('arrow_list').addEventListener('click',(ev)=>{
			const btn = ev.target.closest('button'); if(!btn) return; const id=Number(btn.getAttribute('data-id')); const act=btn.getAttribute('data-act');
			if(act==='del'){ let arr=getArrows(); arr=arr.filter(x=>x.id!==id); saveArrows(arr); renderArrows(); }
			if(act==='use'){ const arr=getArrows(); const a=arr.find(x=>x.id===id); if(!a) return; document.getElementById('eq_arrows').value=a.name; document.getElementById('setup_arrows').value=a.name; }
		});

		function populateArrowSelects(){ const arr=getArrows(); const sel1=document.getElementById('eq_arrows_select'); const sel2=document.getElementById('setup_arrows_select'); if(!sel1||!sel2) return; sel1.innerHTML='<option value="">Choose arrow model‚Ä¶</option>'; sel2.innerHTML='<option value="">Choose arrow model‚Ä¶</option>'; arr.forEach(a=>{ const o=document.createElement('option'); o.value=a.name; o.textContent=a.name + (a.spine?(' ‚Ä¢ '+a.spine):''); sel1.appendChild(o); const o2=o.cloneNode(true); sel2.appendChild(o2); }); }

		// when select changes, populate input
		const selEq=document.getElementById('eq_arrows_select'); if(selEq) selEq.addEventListener('change',()=>{ const v=selEq.value; if(v) document.getElementById('eq_arrows').value=v; });
		const selSetup=document.getElementById('setup_arrows_select'); if(selSetup) selSetup.addEventListener('change',()=>{ const v=selSetup.value; if(v) document.getElementById('setup_arrows').value=v; });

		// initial populate
		populateArrowSelects();
	})();
	// Catch unhandled button clicks and show error
	document.addEventListener('click', (e) => {
		const btn = e.target.closest('button:not([data-bs-dismiss])'); 
		if(!btn) return;
		if(btn.onclick || btn.getAttribute('onclick')) return;
		if(!btn.id && !btn.getAttribute('data-action')) {
			e.preventDefault();
			alert('This feature is not yet implemented.');
		}
	});
	</script>
</body>
</html>
