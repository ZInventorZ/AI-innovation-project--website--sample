<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Equipment Setup</title>
	<link rel="stylesheet" href="style.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>

<body>
	<!-- Top-left back button: tries history.back(), falls back to index.html -->
	<a class="back-btn" href="index.html" onclick="if(history.length>1){history.back();return false;}">‚Üê Back</a>
	<main class="container py-4">
		<h1>Equipment Setup</h1>
		<!-- Page purpose: create and persist equipment setups (arrows, sight, bow)
		     Saved setups stored in localStorage under key 'equipmentSetups'.
		     Edit the UI templates below to add/remove fields. -->
		<p class="text-muted">Create and save equipment setups for quick use.</p>

		<!-- Buttons to choose equipment category -->
		<div class="btn-group mb-3" role="group" aria-label="Equipment type">
			<button id="btnArrows" class="btn btn-outline-primary">Arrows</button>
			<button id="btnSight" class="btn btn-outline-primary">Sight</button>
			<button id="btnBow" class="btn btn-outline-primary">Bow</button>
		</div>

		<!-- Setup form: fields change depending on selected type -->
		<div id="setupCard" class="card p-3 mb-3">
			<div class="mb-2">
				<label class="form-label">Setup name</label>
				<input id="setupName" class="form-control" placeholder="e.g. Outdoor 70m - Recurve" />
			</div>

			<form id="setupForm">
				<!-- Dynamic fields inserted here -->
				<div id="dynamicFields"></div>
			</form>

			<div class="mt-3 d-flex gap-2">
				<button id="saveSetup" class="btn btn-success">Save Setup</button>
				<button id="previewSetup" class="btn btn-secondary">Preview</button>
				<button id="clearSetup" class="btn btn-outline-danger">Clear</button>
			</div>
		</div>

		<!-- Preview / saved list -->
		<div class="row">
			<div class="col-md-6">
				<h5>Saved Setups</h5>
				<ul id="savedList" class="list-group"></ul>
			</div>
			<div class="col-md-6">
				<h5>Preview</h5>
				<pre id="preview" class="p-2 bg-light border" style="white-space:pre-wrap"></pre>
			</div>
		</div>

	</main>

	<!-- Bottom navigation: mirror other pages for consistent navigation -->
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-bottom">
		<div class="container-fluid">
			<a class="navbar-brand" href="index.html">AI Innovation</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="nav nav-pills ms-auto" role="tablist">
					<li class="nav-item" role="presentation">
                        <a class="nav-link" href="index.html" title="History"><span class="nav-icon">üìà</span>History</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" href="AI_Coach.html" title="AI Coach"><span class="nav-icon">ü§ñ</span>AI Coach</a>
                    </li>
					<li class="nav-item" role="presentation">
                        <a class="nav-link active" href="equipment.html" title="Equipment"><span class="nav-icon">üèπ</span>Equipment</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" href="Scores.html" title="Statistics"><span class="nav-icon">üìä</span>Statistics</a>
					</li>
                    
					<li class="nav-item" role="presentation">
						<a class="nav-link" href="competition.html" title="Competition"><span class="nav-icon">üèÜ</span>Competition</a>
					</li>
					<li class="nav-item" role="presentation">
						<a class="nav-link" href="menu.html">Menu</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<script>
	/*
	 JS: handles dynamic UI for arrows, sight, and bow setups.
	 - Saved setups are stored in localStorage key 'equipmentSetups' as an array.
	 - Each setup object: { id, name, type, data }
	 - To extend fields, edit the HTML templates in showArrows/showSight/showBow
	 - Keep names for inputs in '[name="..."]' so gatherData() can read them.
	*/
	(function(){
		const btnArrows = document.getElementById('btnArrows');
		const btnSight = document.getElementById('btnSight');
		const btnBow = document.getElementById('btnBow');
		const dynamic = document.getElementById('dynamicFields');
		const saveBtn = document.getElementById('saveSetup');
		const previewBtn = document.getElementById('previewSetup');
		const clearBtn = document.getElementById('clearSetup');
		const savedList = document.getElementById('savedList');
		const preview = document.getElementById('preview');
		const setupName = document.getElementById('setupName');

		let currentType = 'arrows';

		// Helpers for storage
		function getSetups(){ return JSON.parse(localStorage.getItem('equipmentSetups')||'[]'); }
		function saveSetups(arr){ localStorage.setItem('equipmentSetups', JSON.stringify(arr)); }

		// Render saved setups
		function renderSaved(){ savedList.innerHTML=''; const arr=getSetups(); arr.forEach(s=>{ const li=document.createElement('li'); li.className='list-group-item d-flex justify-content-between align-items-start'; li.innerHTML = `<div><strong>${s.name}</strong><div class="small text-muted">${s.type}</div></div><div class="btn-group btn-group-sm"><button data-id="${s.id}" class="btn btn-outline-primary load">Load</button><button data-id="${s.id}" class="btn btn-outline-danger del">Delete</button></div>`; savedList.appendChild(li); });
			// hook events
			Array.from(savedList.querySelectorAll('.load')).forEach(b=>b.addEventListener('click',e=>{ const id=Number(e.target.dataset.id); const s=getSetups().find(x=>x.id===id); if(s){ loadSetup(s); preview.textContent = JSON.stringify(s, null, 2); } }));
			Array.from(savedList.querySelectorAll('.del')).forEach(b=>b.addEventListener('click',e=>{ const id=Number(e.target.dataset.id); const arr=getSetups().filter(x=>x.id!==id); saveSetups(arr); renderSaved(); }));
		}

		// Build field templates per type
		function showArrows(){
			currentType='arrows';
			dynamic.innerHTML = `
				<!-- Arrow fields: length, fletch type, fletch count, material, diameter, spine, weight -->
				<div class="row g-2">
					<div class="col-6"><label class="form-label">Length (mm)</label><input name="length" class="form-control" type="number"/></div>
					<div class="col-6"><label class="form-label">Fletch Type</label><input name="fletchType" class="form-control" placeholder="e.g. plastic vanes"/></div>
					<div class="col-6"><label class="form-label">Fletch Count</label><input name="fletchCount" class="form-control" type="number"/></div>
					<div class="col-6"><label class="form-label">Material</label><input name="material" class="form-control" placeholder="carbon/alu/wood"/></div>
					<div class="col-6"><label class="form-label">Diameter (mm)</label><input name="diameter" class="form-control" type="number" step="0.1"/></div>
					<div class="col-6"><label class="form-label">Spine</label><input name="spine" class="form-control" placeholder="e.g. 500"/></div>
					<div class="col-6"><label class="form-label">Weight (gr)</label><input name="weight" class="form-control" type="number" step="0.1"/></div>
				</div>`;
		}

		function showBow(){
			currentType='bow';
			dynamic.innerHTML = `
				<div class="row g-2">
					<div class="col-6"><label class="form-label">Bow Type</label><input name="bowType" class="form-control" placeholder="recurve/compound"/></div>
					<div class="col-6"><label class="form-label">Draw Weight (lbs)</label><input name="drawWeight" class="form-control" type="number"/></div>
					<div class="col-6"><label class="form-label">Riser Length (mm)</label><input name="riserLength" class="form-control" type="number"/></div>
					<div class="col-6"><label class="form-label">Limb Material</label><input name="limbMaterial" class="form-control"/></div>
					<div class="col-12"><label class="form-label">Notes</label><textarea name="bowNotes" class="form-control" rows="2"></textarea></div>
				</div>`;
		}

		function showSight(){
			currentType='sight';
			dynamic.innerHTML = `
				<div class="row g-2">
					<div class="col-6"><label class="form-label">Sight Type</label><input name="sightType" class="form-control" placeholder="single-pin / multi-pin"/></div>
					<div class="col-6"><label class="form-label">Lens? (shows power)</label><div class="form-check form-switch"><input id="lensToggle" name="hasLens" class="form-check-input" type="checkbox"></div></div>
					<div id="lensFields" class="col-12" style="display:none;"><label class="form-label">Lens Power</label><input name="lensPower" class="form-control" placeholder="e.g. +1.5"/><label class="form-label mt-2">Clarifier (optional)</label><input name="clarifier" class="form-control" placeholder="e.g. clear/neutral"/></div>
					<div class="col-12"><label class="form-label">Pins</label><div id="pinsContainer"></div><div class="mt-2"><button id="addPin" type="button" class="btn btn-sm btn-outline-primary">Add Pin</button></div></div>
				</div>

				<!-- hidden template for each pin line: pin color + distance for multi-pin setups -->
				<template id="pinTpl">
					<div class="d-flex gap-2 align-items-center pin-line mb-2">
						<input name="pinColor" class="form-control form-control-color" type="color" title="Color" style="width:56px" />
						<input name="pinDistance" class="form-control" type="number" placeholder="Distance (m)" />
						<button type="button" class="btn btn-sm btn-outline-danger remove-pin">Remove</button>
					</div>
				</template>`;

			// hook lens toggle and add pin button
			setTimeout(()=>{
				const lensToggle = document.getElementById('lensToggle');
				const lensFields = document.getElementById('lensFields');
				lensToggle.addEventListener('change',()=>{ lensFields.style.display = lensToggle.checked ? 'block' : 'none'; });
				document.getElementById('addPin').addEventListener('click', addPin);
			},0);
		}

		// Add a new pin entry to the pinsContainer. Each pin records color + distance.
		function addPin(){
			const tpl = document.getElementById('pinTpl');
			const node = tpl.content.cloneNode(true);
			const container=document.getElementById('pinsContainer');
			container.appendChild(node);
			container.querySelectorAll('.remove-pin').forEach(b=>b.addEventListener('click',e=>e.target.closest('.pin-line').remove()));
		}

		// Load a saved setup into the UI for editing
		function loadSetup(s){ setupName.value = s.name || ''; if(s.type==='arrows'){ showArrows(); setTimeout(()=>{ Object.keys(s.data||{}).forEach(k=>{ const el = dynamic.querySelector('[name="'+k+'"]'); if(el) el.value = s.data[k]; }); },0); }
			if(s.type==='sight'){ showSight(); setTimeout(()=>{ const d=s.data||{}; if(d.hasLens){ document.getElementById('lensToggle').checked=true; document.getElementById('lensFields').style.display='block'; dynamic.querySelector('[name="lensPower"]').value = d.lensPower||''; dynamic.querySelector('[name="clarifier"]').value = d.clarifier||''; }
				// load pins
				(d.pins||[]).forEach(p=>{ addPin(); const pc = document.getElementById('pinsContainer'); const last = pc.querySelector('.pin-line:last-child'); last.querySelector('[name="pinColor"]').value = p.color||'#000000'; last.querySelector('[name="pinDistance"]').value = p.distance||''; });
			},0); }
			if(s.type==='bow'){ showBow(); setTimeout(()=>{ Object.keys(s.data||{}).forEach(k=>{ const el = dynamic.querySelector('[name="'+k+'"]'); if(el) el.value = s.data[k]; }); },0); }
		}

		// gather form data depending on type
		function gatherData(){ const data={}; if(currentType==='arrows'){ ['length','fletchType','fletchCount','material','diameter','spine','weight'].forEach(n=>{ const el = dynamic.querySelector('[name="'+n+'"]'); if(el) data[n]=el.value; }); }
			else if(currentType==='bow'){ ['bowType','drawWeight','riserLength','limbMaterial','bowNotes'].forEach(n=>{ const el = dynamic.querySelector('[name="'+n+'"]'); if(el) data[n]=el?el.value:''; }); }
			else if(currentType==='sight'){ const hasLens = dynamic.querySelector('[name="hasLens"]')?.checked; data.hasLens = !!hasLens; if(hasLens){ data.lensPower = dynamic.querySelector('[name="lensPower"]')?.value; data.clarifier = dynamic.querySelector('[name="clarifier"]')?.value; }
				data.pins = Array.from(dynamic.querySelectorAll('.pin-line')).map(pl=>({ color: pl.querySelector('[name="pinColor"]').value, distance: pl.querySelector('[name="pinDistance"]').value })); }
			return data; }

		// Save setup
		saveBtn.addEventListener('click', ()=>{
			const name = setupName.value.trim() || (currentType+' setup ' + new Date().toLocaleString());
			const obj = { id: Date.now(), name, type: currentType, data: gatherData() };
			const arr = getSetups(); arr.push(obj); saveSetups(arr); renderSaved();
			preview.textContent = JSON.stringify(obj, null, 2);
		});

		previewBtn.addEventListener('click', ()=>{ const obj = { name: setupName.value||'(unnamed)', type: currentType, data: gatherData() }; preview.textContent = JSON.stringify(obj, null, 2); });
		clearBtn.addEventListener('click', ()=>{ setupName.value=''; dynamic.innerHTML=''; if(currentType==='sight') showSight(); if(currentType==='arrows') showArrows(); if(currentType==='bow') showBow(); preview.textContent=''; });

		// type button handlers
		btnArrows.addEventListener('click', ()=>{ showArrows(); });
		btnSight.addEventListener('click', ()=>{ showSight(); });
		btnBow.addEventListener('click', ()=>{ showBow(); });

		// init
		showArrows(); renderSaved();
	})();
	</script>
</body>
</html>

