<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>AI Innovation Project - AI Coach</title>
	<link rel="stylesheet" href="style.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
	<link rel="icon" href="images/AIchery_logo.png" type="image/png">
	<style>
		.coach-card {
			border: none;
			border-left: 4px solid var(--accent);
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
			transition: transform 0.2s, box-shadow 0.2s;
			margin-bottom: 1.5rem;
		}
		.coach-card:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
		}
		.coach-card .card-header {
			border-color: transparent;
			border-radius: 0;
			padding: 1rem 1.25rem;
			font-weight: 600;
			letter-spacing: 0.5px;
		}
		.btn-objective {
			border-radius: 20px;
			padding: 0.6rem 1.5rem;
			font-weight: 500;
			transition: all 0.3s ease;
			border: 2px solid rgba(255, 193, 7, 0.3);
		}
		.btn-objective.active {
			background: linear-gradient(135deg, #FFC107 0%, #FF9800 100%);
			color: white;
			border-color: transparent;
			box-shadow: 0 4px 15px rgba(255, 193, 7, 0.4);
		}
		.btn-group-custom .btn {
			border-radius: 8px;
			padding: 0.6rem 1.2rem;
			font-weight: 500;
			margin: 0.25rem;
			flex-grow: 1;
			transition: all 0.2s;
		}
		.btn-group-custom .btn.active {
			background: var(--accent);
			color: white;
			border-color: var(--accent);
			box-shadow: 0 4px 10px rgba(13, 110, 253, 0.3);
		}
		.preset-btn {
			border-radius: 12px;
			padding: 0.8rem;
			font-weight: 500;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			border: none;
			color: white;
			transition: all 0.3s;
			box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
		}
		.preset-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
			color: white;
		}
		.header-gradient {
			background: linear-gradient(135deg, var(--accent) 0%, #0052cc 100%);
			color: white;
			padding: 2rem 1.5rem;
			border-radius: 12px;
			margin-bottom: 2rem;
		}
		.header-gradient h2 {
			font-weight: 700;
			margin: 0.5rem 0 0 0;
			letter-spacing: -0.5px;
		}
		.header-gradient p {
			margin: 0.5rem 0 0 0;
			opacity: 0.95;
			font-size: 0.95rem;
		}
		.feedback-badge {
			background: linear-gradient(135deg, #10B981 0%, #059669 100%);
			color: white;
			padding: 1.5rem;
			border-radius: 12px;
			margin-top: 1.5rem;
			box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
		}
		.feedback-badge strong {
			display: block;
			font-size: 1.1rem;
			margin-bottom: 0.5rem;
		}
		#feedback-display {
			animation: slideDown 0.3s ease;
		}
		@keyframes slideDown {
			from {
				opacity: 0;
				transform: translateY(-10px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}
		.section-label {
			font-weight: 700;
			color: var(--accent);
			text-transform: uppercase;
			letter-spacing: 1px;
			font-size: 0.85rem;
			margin-bottom: 1rem;
			display: block;
		}
		.modal-content {
			border: none;
			border-radius: 16px;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
		}
		.modal-header {
			border-bottom: none;
			padding: 1.5rem;
			border-radius: 16px 16px 0 0;
		}
		.large-btn {
			padding: 1rem;
			font-size: 1rem;
			border-radius: 10px;
			font-weight: 600;
			transition: all 0.2s;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
		}
		.large-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
		}
		.site-main {
			padding-bottom: 100px;
		}
		.collapse-icon::before {
			content: "‚àí";
		}
		.collapsed .collapse-icon::before {
			content: "+";
		}
		.loading-bar {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background: rgba(255, 255, 255, 0.95);
			border-radius: 20px;
			padding: 20px;
			box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			border: 3px solid var(--accent);
		}
		.loading-container {
			display: flex;
			align-items: center;
			justify-content: space-between;
			width: 300px;
			position: relative;
		}
		.bow-icon, .target-icon {
			font-size: 2rem;
			z-index: 2;
		}
		.progress-track {
			flex: 1;
			height: 4px;
			background: #e0e0e0;
			border-radius: 2px;
			margin: 0 10px;
			position: relative;
			overflow: hidden;
		}
		.progress-arrow {
			position: absolute;
			top: -8px;
			left: -20px;
			font-size: 1.5rem;
			animation: arrowMove 2s linear infinite;
		}
		@keyframes arrowMove {
			0% { left: -20px; }
			100% { left: calc(100% + 20px); }
		}
	</style>
</head>
<body>
	<!-- Top-left back button: tries history.back(), falls back to index.html -->
	<a class="back-btn" href="index.html" onclick="if(history.length>1){history.back();return false;}">‚Üê Back</a>
	<header class="page-header">
		<div class="container">
			<div class="d-flex align-items-center gap-3">
				<img src="images/AIchery_logo_full_sized.png" alt="AIchery Logo" style="max-width: 150px; height: auto;">
				<div>
					<h1 style="margin: 0;">AI Coach</h1>
				</div>
			</div>
		</div>
	</header>
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-bottom">
    <div class="container-fluid">
        <ul class="nav nav-pills ms-auto" role="tablist">
          <li class="nav-item"><a class="nav-link" href="index.html"><span class="nav-icon">üìà</span>History</a></li>
          <li class="nav-item"><a class="nav-link active" href="AI_Coach.html"><span class="nav-icon">ü§ñ</span>AI Coach</a></li>
          <li class="nav-item"><a class="nav-link" href="equipment.html"><span class="nav-icon">üèπ</span>Equipment</a></li>
          <li class="nav-item"><a class="nav-link" href="statistics.html"><span class="nav-icon">üìä</span>Statistics</a></li>
          <li class="nav-item"><a class="nav-link" href="competition.html"><span class="nav-icon">üèÜ</span>Competition</a></li>
          <li class="nav-item"><a class="nav-link" href="menu.html"><span class="nav-icon">‚ò∞</span>Menu</a></li>
        </ul>
    </div>
  </nav>

	<main class="site-main container py-4">
		
		<!-- DRILLS SECTION -->
		<div class="coach-card card">
			<div class="card-header" style="background: linear-gradient(135deg, #FF6B6B 0%, #FF8E72 100%); color: white;">
				<strong>‚ö° Drills & Training</strong>
				<button class="btn btn-sm btn-light ms-2 float-end" type="button" data-bs-toggle="collapse" data-bs-target="#drillsCollapse" aria-expanded="true" aria-controls="drillsCollapse">
					<span class="collapse-icon">‚àí</span>
				</button>
			</div>
			<div id="drillsCollapse" class="collapse show">
			<div class="card-body">
				<div class="mb-4">
					<span class="section-label">Training Focus</span>
					<div class="row g-2 mb-3">
						<div class="col-6">
							<button id="objStrength" class="btn btn-objective w-100 active" data-objective="strength">üí™ Strength</button>
						</div>
						<div class="col-6">
							<button id="objEndurance" class="btn btn-objective w-100" data-objective="endurance">üèÉ Endurance</button>
						</div>
						<div class="col-12">
							<button id="objConsistency" class="btn btn-objective w-100" data-objective="consistency">üéØ Consistency</button>
						</div>
					</div>
				</div>

				<div class="mb-4">
					<span class="section-label">Difficulty Level</span>
					<div class="btn-group w-100 mb-3" role="group">
						<button id="diffbegin" class="btn btn-outline-secondary btn-group-custom">Beginner</button>
						<button id="diffinter" class="btn btn-outline-secondary btn-group-custom active">Intermediate</button>
						<button id="diffadv" class="btn btn-outline-secondary btn-group-custom">Advanced</button>
					</div>
				</div>
				
				<div class="mb-4">
					<span class="section-label">Preset Drills</span>
					<div class="row g-2">
						<div class="col-6">
							<button id="presetShort" class="btn preset-btn w-100 btn-sm">Short Range</button>
						</div>
						<div class="col-6">
							<button id="presetComp" class="btn preset-btn w-100 btn-sm">Competition</button>
						</div>
						<div class="col-6">
							<button id="presetEnd" class="btn preset-btn w-100 btn-sm">Endurance</button>
						</div>
						<div class="col-6">
							<button id="presetWarm" class="btn preset-btn w-100 btn-sm">Warm-up</button>
						</div>
					</div>
				</div>

				<div class="d-grid gap-2 mt-4">
					<button id="scheduleBtn" class="btn btn-lg btn-info large-btn">üìÖ Weekly Practice Schedule</button>
				</div>
			</div>
			</div>
		</div>

		<!-- FORM ANALYSIS SECTION -->
		<div class="coach-card card">
			<div class="card-header" style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white;">
				<strong>üé• Form Analysis</strong>
				<button class="btn btn-sm btn-light ms-2 float-end" type="button" data-bs-toggle="collapse" data-bs-target="#formCollapse" aria-expanded="true" aria-controls="formCollapse">
					<span class="collapse-icon">‚àí</span>
				</button>
			</div>
			<div id="formCollapse" class="collapse show">
			<div class="card-body">
				<div class="mb-4">
					<span class="section-label">Experience Level</span>
					<div class="btn-group w-100 mb-3" role="group">
						<button id="expBeginner" class="btn btn-outline-success btn-group-custom">Beginner</button>
						<button id="expIntermediate" class="btn btn-outline-success btn-group-custom active">Intermediate</button>
						<button id="expAdvanced" class="btn btn-outline-success btn-group-custom">Advanced</button>
					</div>
				</div>

				<div class="mb-4">
					<span class="section-label">Mode</span>
					<div class="btn-group w-100 mb-3" role="group">
						<button id="modeBeginner" class="btn btn-outline-primary btn-group-custom">üéØ Beginner Mode</button>
						<button id="modeCompetitive" class="btn btn-outline-primary btn-group-custom active">üèπ Competitive Mode</button>
						<button id="modeTournament" class="btn btn-outline-primary btn-group-custom">üèÜ Tournament Prep Mode</button>
						<button id="modeTuning" class="btn btn-outline-primary btn-group-custom">üõ† Equipment Tuning Mode</button>
					</div>
				</div>

				<div class="mb-4">
					<span class="section-label">Form Focus</span>
					<div class="btn-group w-100 mb-3" role="group">
						<button id="focusStance" class="btn btn-outline-info btn-group-custom active">Stance</button>
						<button id="focusDraw" class="btn btn-outline-info btn-group-custom">Draw</button>
						<button id="focusAnchor" class="btn btn-outline-info btn-group-custom">Anchor</button>
						<button id="focusGrip" class="btn btn-outline-info btn-group-custom">Grip</button>
						<button id="focusBowArm" class="btn btn-outline-info btn-group-custom">Bow Arm</button>
						<button id="focusRelease" class="btn btn-outline-info btn-group-custom">Release</button>
						<button id="focusFollow" class="btn btn-outline-info btn-group-custom">Follow-through</button>
					</div>
				</div>

				<div class="mb-4">
					<span class="section-label">Settings</span>
					<div class="form-check form-switch mb-2">
						<input class="form-check-input" type="checkbox" id="liveFeedback" checked>
						<label class="form-check-label" for="liveFeedback">Live feedback during shooting</label>
					</div>
					<div class="form-check form-switch mb-3">
						<input class="form-check-input" type="checkbox" id="soundEnabled" checked>
						<label class="form-check-label" for="soundEnabled">Sound notifications</label>
					</div>
				</div>

				<div class="d-grid gap-2">
					<button id="analyseForm" class="btn btn-lg btn-warning large-btn">üì∏ Start Form Analysis</button>
					<div class="d-flex gap-2 mt-2">
						<button id="newPracticeNameBtn" class="btn btn-outline-primary flex-grow-1">Ôºã New Practice</button>
						<button id="createUnidentifiedBtn" class="btn btn-outline-danger flex-grow-1">Unidentified</button>
					</div>
					<button id="viewStats" class="btn btn-info large-btn">üìä View Session Stats</button>
					<button id="getTips" class="btn btn-success large-btn">üí° Get Tips</button>
				</div>
			</div>
			</div>
		</div>

		<!-- Loading Bar -->
		<div id="loading-bar" class="loading-bar" style="display:none">
			<div class="loading-container">
				<span class="bow-icon">üèπ</span>
				<div class="progress-track">
					<div class="progress-arrow">‚û°Ô∏è</div>
				</div>
				<span class="target-icon">üéØ</span>
			</div>
		</div>

		<div id="feedback-display" class="feedback-badge" style="display:none">
			<strong>‚ú® AI Coach Feedback</strong>
			<div id="feedback-content"></div>
		</div>
	</main>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<script>
	(function(){
		// AI Coach state
		const coachState = {
				objective: 'strength',
			difficulty: 'intermediate',
			experienceLevel: 'intermediate',
				liveFeedbackEnabled: true,
				soundEnabled: true,
			formFocus: 'stance'
		};


		// Save state to localStorage
		function saveState(){
			localStorage.setItem('aiCoachState', JSON.stringify(coachState));
		}

		// Load state from localStorage
		function loadState(){
			const saved = localStorage.getItem('aiCoachState');
			if(saved){
				Object.assign(coachState, JSON.parse(saved));
			}
		}

		// Initialize UI based on state
		function initializeUI(){
			loadState();
			
			// Set objective buttons
			document.querySelectorAll('[data-objective]').forEach(btn=>{
				btn.classList.toggle('active', btn.dataset.objective === coachState.objective);
			});
			
			// Set difficulty buttons
			document.getElementById('diffbegin').classList.toggle('active', coachState.difficulty === 'beginner');
			document.getElementById('diffinter').classList.toggle('active', coachState.difficulty === 'intermediate');
			document.getElementById('diffadv').classList.toggle('active', coachState.difficulty === 'advanced');
			
			// Set experience level buttons
			document.getElementById('expBeginner').classList.toggle('active', coachState.experienceLevel === 'beginner');
			document.getElementById('expIntermediate').classList.toggle('active', coachState.experienceLevel === 'intermediate');
			document.getElementById('expAdvanced').classList.toggle('active', coachState.experienceLevel === 'advanced');
			
			// Set form focus buttons
			document.getElementById('focusStance').classList.toggle('active', coachState.formFocus === 'stance');
			document.getElementById('focusDraw').classList.toggle('active', coachState.formFocus === 'draw');
			document.getElementById('focusAnchor').classList.toggle('active', coachState.formFocus === 'anchor');
			document.getElementById('focusRelease').classList.toggle('active', coachState.formFocus === 'release');
			document.getElementById('focusBowArm').classList.toggle('active', coachState.formFocus === 'bowarm');
			document.getElementById('focusGrip').classList.toggle('active', coachState.formFocus === 'grip');
			document.getElementById('focusRelease').classList.toggle('active', coachState.formFocus === 'release');
			document.getElementById('focusFollow').classList.toggle('active', coachState.formFocus === 'follow');
			
			// Set checkboxes
			document.getElementById('liveFeedback').checked = coachState.liveFeedbackEnabled;
			document.getElementById('soundEnabled').checked = coachState.soundEnabled;

				// Mode: default to competitive if not set
				if(!coachState.mode) coachState.mode = 'competitive';
				document.getElementById('modeBeginner').classList.toggle('active', coachState.mode === 'beginner');
				document.getElementById('modeCompetitive').classList.toggle('active', coachState.mode === 'competitive');
				document.getElementById('modeTournament').classList.toggle('active', coachState.mode === 'tournament');
				document.getElementById('modeTuning').classList.toggle('active', coachState.mode === 'tuning');

				// render recent sessions
				renderRecentSessions();
		}

		// Training Objectives
		document.getElementById('objStrength').addEventListener('click', ()=>{
			coachState.objective = 'strength';
			document.querySelectorAll('[data-objective]').forEach(b=>b.classList.remove('active'));
			document.getElementById('objStrength').classList.add('active');
			saveState();
			showFeedback('üí™ Strength Focus: Building power and draw consistency. Focus on maintaining tension in core and back muscles.');
		});
		document.getElementById('objEndurance').addEventListener('click', ()=>{
			coachState.objective = 'endurance';
			document.querySelectorAll('[data-objective]').forEach(b=>b.classList.remove('active'));
			document.getElementById('objEndurance').classList.add('active');
			saveState();
			showFeedback('üèÉ Endurance Focus: Building stamina for longer sessions. Practice multiple rounds with shorter rest periods.');
		});
		document.getElementById('objConsistency').addEventListener('click', ()=>{
			coachState.objective = 'consistency';
			document.querySelectorAll('[data-objective]').forEach(b=>b.classList.remove('active'));
			document.getElementById('objConsistency').classList.add('active');
			saveState();
			showFeedback('üéØ Consistency Focus: Improving shot-to-shot consistency. Standardize your technique for every arrow.');
		});

		// Difficulty selection
		document.getElementById('diffbegin').addEventListener('click', ()=>{
			coachState.difficulty = 'beginner';
			document.querySelectorAll('[id^="diff"]').forEach(b=>b.classList.remove('active'));
			document.getElementById('diffbegin').classList.add('active');
			saveState();
		});
		document.getElementById('diffinter').addEventListener('click', ()=>{
			coachState.difficulty = 'intermediate';
			document.querySelectorAll('[id^="diff"]').forEach(b=>b.classList.remove('active'));
			document.getElementById('diffinter').classList.add('active');
			saveState();
		});
		document.getElementById('diffadv').addEventListener('click', ()=>{
			coachState.difficulty = 'advanced';
			document.querySelectorAll('[id^="diff"]').forEach(b=>b.classList.remove('active'));
			document.getElementById('diffadv').classList.add('active');
			saveState();
		});

		// Experience Level selection
		document.getElementById('expBeginner').addEventListener('click', ()=>{
			coachState.experienceLevel = 'beginner';
			document.querySelectorAll('[id^="exp"]').forEach(b=>b.classList.remove('active'));
			document.getElementById('expBeginner').classList.add('active');
			saveState();
			showFeedback('üî∞ Beginner Mode: Focus on fundamental techniques and basic form corrections.');
		});
		document.getElementById('expIntermediate').addEventListener('click', ()=>{
			coachState.experienceLevel = 'intermediate';
			document.querySelectorAll('[id^="exp"]').forEach(b=>b.classList.remove('active'));
			document.getElementById('expIntermediate').classList.add('active');
			saveState();
			showFeedback('üìà Intermediate Mode: Refined technique improvements and advanced form feedback.');
		});
		document.getElementById('expAdvanced').addEventListener('click', ()=>{
			coachState.experienceLevel = 'advanced';
			document.querySelectorAll('[id^="exp"]').forEach(b=>b.classList.remove('active'));
			document.getElementById('expAdvanced').classList.add('active');
			saveState();
			showFeedback('üèÜ Advanced Mode: Competitive-level analysis with detailed micro-adjustments.');
		});

		// Form Focus selection
		document.getElementById('focusStance').addEventListener('click', ()=>{
			coachState.formFocus = 'stance';
			document.querySelectorAll('[id^="focus"]').forEach(b=>b.classList.remove('active'));
			document.getElementById('focusStance').classList.add('active');
			saveState();
			showFeedback('üìê Stance Focus: Analyzing foot position, alignment, and balance.');
		});
			document.getElementById('focusGrip').addEventListener('click', ()=>{
				coachState.formFocus = 'grip';
				document.querySelectorAll('[id^="focus"]').forEach(b=>b.classList.remove('active'));
				document.getElementById('focusGrip').classList.add('active');
				saveState();
				showFeedback('‚úä Grip Focus: Evaluating hand placement, tension, and consistency.');
			});
			document.getElementById('focusBowArm').addEventListener('click', ()=>{
				coachState.formFocus = 'bowarm';
				document.querySelectorAll('[id^="focus"]').forEach(b=>b.classList.remove('active'));
				document.getElementById('focusBowArm').classList.add('active');
				saveState();
				showFeedback('üí™ Bow Arm Focus: Assessing arm alignment, extension and stability.');
			});
		document.getElementById('focusDraw').addEventListener('click', ()=>{
			coachState.formFocus = 'draw';
			document.querySelectorAll('[id^="focus"]').forEach(b=>b.classList.remove('active'));
			document.getElementById('focusDraw').classList.add('active');
			saveState();
			showFeedback('üèπ Draw Focus: Evaluating draw length, back tension, and shoulder alignment.');
		});
		document.getElementById('focusAnchor').addEventListener('click', ()=>{
			coachState.formFocus = 'anchor';
			document.querySelectorAll('[id^="focus"]').forEach(b=>b.classList.remove('active'));
			document.getElementById('focusAnchor').classList.add('active');
			saveState();
			showFeedback('üéØ Anchor Focus: Checking anchor point consistency and head position.');
		});
		document.getElementById('focusRelease').addEventListener('click', ()=>{
			coachState.formFocus = 'release';
			document.querySelectorAll('[id^="focus"]').forEach(b=>b.classList.remove('active'));
			document.getElementById('focusRelease').classList.add('active');
			saveState();
			showFeedback('üí® Release Focus: Analyzing release timing and follow-through mechanics.');
		});
		document.getElementById('focusFollow').addEventListener('click', ()=>{
			coachState.formFocus = 'follow';
			document.querySelectorAll('[id^="focus"]').forEach(b=>b.classList.remove('active'));
			document.getElementById('focusFollow').classList.add('active');
			saveState();
			showFeedback('üîÑ Follow-through Focus: Monitoring post-release form and bow arm movement.');
		});

		// Checkbox listeners
		document.getElementById('liveFeedback').addEventListener('change', (e)=>{
			coachState.liveFeedbackEnabled = e.target.checked;
			saveState();
		});
		document.getElementById('soundEnabled').addEventListener('change', (e)=>{
			coachState.soundEnabled = e.target.checked;
			saveState();
		});

		// Preset drills
		document.getElementById('presetShort').addEventListener('click', ()=>{
			showFeedback('Short Range Preset loaded: 3 ends of 3 arrows at 18m - Perfect for warm-ups and quick drills.');
		});
		document.getElementById('presetComp').addEventListener('click', ()=>{
			showFeedback('Competition Preset loaded: 10 ends of 3 arrows at 50m (Vegas 300 format) - Full competition simulation.');
		});
		document.getElementById('presetEnd').addEventListener('click', ()=>{
			showFeedback('Endurance Preset loaded: 20 ends of 6 arrows at 25m - Build stamina and consistency.');
		});
		document.getElementById('presetWarm').addEventListener('click', ()=>{
			showFeedback('Warm-up Preset loaded: 2 ends of 3 arrows at multiple distances - Prepare for main practice session.');
		});

		// Practice Schedule Button
		document.getElementById('scheduleBtn').addEventListener('click', ()=>{
			const schedule = {
				'Monday': 'üí™ Strength Training (30 min) - Focus on form and power building',
				'Tuesday': 'Rest or Light Practice',
				'Wednesday': 'üéØ Consistency Drills (45 min) - Shot-to-shot repeatability',
				'Thursday': 'Rest or Light Practice', 
				'Friday': 'üèÉ Endurance Session (60 min) - Multiple rounds, building stamina',
				'Saturday': 'üèÜ Competition Simulation (90 min) - Full rounds under pressure',
				'Sunday': 'üìä Analysis & Recovery - Review footage and plan improvements'
			};
			
			let scheduleHtml = '<div style="max-height:400px;overflow-y:auto">';
			for(const [day, activity] of Object.entries(schedule)){
				scheduleHtml += `<div style="padding:8px;border-bottom:1px solid #ddd"><strong>${day}:</strong> ${activity}</div>`;
			}
			scheduleHtml += '</div>';
			
			const mdl = document.createElement('div');
			mdl.innerHTML = `<div class="modal fade" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">üìÖ Weekly Practice Schedule</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body">${scheduleHtml}</div><div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Close</button></div></div></div></div>`;
			document.body.appendChild(mdl);
			const bsModal = new bootstrap.Modal(mdl.querySelector('.modal'));
			bsModal.show();
			mdl.querySelector('.modal').addEventListener('hidden.bs.modal', ()=> mdl.remove());
		});

		// Available images for feedback
		const feedbackImages = [
			'images/ready_to_fire.jpg',
			'images/full_draw_setting anchor.jpg',
			'images/back_angled.webp',
			'images/center_X_target.jpg'
		];

		// Fake feedback based on experience level
		const feedbackData = {
			'beginner': [
				'Good foot positioning! Keep your shoulders relaxed and avoid tension.',
				'Your draw length looks consistent. Maintain this position for better accuracy.',
				'Nice anchor point! Try to keep your elbow slightly higher for better alignment.',
				'Your stance is solid. Focus on keeping your head still during the release.'
			],
			'intermediate': [
				'Excellent back tension! You\'re maintaining good load throughout the draw.',
				'Very consistent form. Minor adjustment: rotate your hips slightly more for better energy transfer.',
				'Your release is smooth, but try to minimize wrist motion for better follow-through.',
				'Great shoulder engagement! Keep this level of tension for competition-ready form.'
			],
			'advanced': [
				'Excellent micro-load execution! Your load-transfer phase is highly efficient.',
				'Precise bow arm tracking detected. Minimal oscillation - competitive-level consistency.',
				'Outstanding release timing. Your arrow departure velocity signature is optimal.',
				'Hip rotation perfectly synchronized with draw curve. Professional-level mechanics detected.'
			]
		};

			// Tools
				document.getElementById('analyseForm').addEventListener('click', ()=>{
				// show an archery-themed loading overlay while preparing analysis
				const loader = document.createElement('div');
				loader.id = 'analysisLoader';
				loader.innerHTML = `
				  <div style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.35);z-index:2000">
				    <div style="padding:18px 22px;border-radius:12px;background:white;display:flex;flex-direction:column;align-items:center;">
				      <style>
				        .archery-loader{display:flex;align-items:center;gap:12px;width:420px}
				        .archery-loader .track{flex:1;position:relative;height:48px;display:flex;align-items:center}
				        .archery-loader .arrow{position:absolute;left:8px;top:6px;width:220px;height:36px;transform-origin:left center;animation:arrow-flight 1200ms linear infinite}
				        @keyframes arrow-flight{0%{transform:translateX(0) rotate(0deg)}50%{transform:translateX(calc(100% - 260px)) rotate(0deg)}100%{transform:translateX(0) rotate(0deg)}}
				        .archery-bow, .archery-target{width:56px;height:56px;flex:0 0 56px}
				      </style>
				
				      <div class="archery-loader">
				        <!-- Bow (left) -->
				        <div class="archery-bow" aria-hidden="true">
				          <svg viewBox="0 0 64 64" width="56" height="56" xmlns="http://www.w3.org/2000/svg">
				            <g fill="none" stroke="#6b4226" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
				              <path d="M12 8 C28 12, 28 52, 12 56" />
				              <path d="M18 12 C30 20, 30 44, 18 52" stroke="#a66f3a"/>
				            </g>
				            <line x1="20" y1="8" x2="44" y2="56" stroke="#333" stroke-width="2" stroke-linecap="round"/>
				          </svg>
				        </div>
				
				        <!-- Track with moving arrow -->
				        <div class="track" aria-hidden="true">
				          <div class="arrow" style="position:absolute;left:8px;top:6px;">
				            <svg viewBox="0 0 220 36" width="220" height="36" xmlns="http://www.w3.org/2000/svg">
				              <g fill="none" stroke="#111" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
				                <line x1="0" y1="18" x2="180" y2="18" stroke="#555" stroke-width="3" stroke-linecap="round"/>
				                <polygon points="180,8 210,18 180,28" fill="#b33" stroke="#800" />
				                <rect x="8" y="10" width="12" height="8" rx="2" fill="#222" />
				              </g>
				            </svg>
				          </div>
				        </div>
				
				        <!-- Target (right) -->
				        <div class="archery-target" aria-hidden="true">
				          <svg viewBox="0 0 64 64" width="56" height="56" xmlns="http://www.w3.org/2000/svg">
				            <circle cx="32" cy="32" r="24" fill="#fff" stroke="#222" stroke-width="2"/>
				            <circle cx="32" cy="32" r="14" fill="#f33" stroke="#b00" stroke-width="2"/>
				            <circle cx="32" cy="32" r="6" fill="#fff" stroke="#c00" stroke-width="1"/>
				          </svg>
				        </div>
				      </div>
				
				      <div style="margin-top:10px;font-weight:600">Preparing analysis‚Ä¶</div>
				    </div>
				  </div>
				`;
				document.body.appendChild(loader);
			const mdl = document.createElement('div');
			const expLevel = coachState.experienceLevel.charAt(0).toUpperCase() + coachState.experienceLevel.slice(1);
			const randomImage = feedbackImages[Math.floor(Math.random() * feedbackImages.length)];
			const feedbackList = feedbackData[coachState.experienceLevel];
			const randomFeedback = feedbackList[Math.floor(Math.random() * feedbackList.length)];
			
				const analysis = {
				'beginner': '<ul><li>Stance and foot position</li><li>Basic anchor point consistency</li><li>Draw length uniformity</li><li>Follow-through stability</li></ul>',
				'intermediate': '<ul><li>Advanced anchor consistency and micro-movements</li><li>Back/shoulder tension balance</li><li>Release technique refinement</li><li>Head/neck position during execution</li><li>Draw curve smoothness</li></ul>',
				'advanced': '<ul><li>Micro-adjustments in hip rotation</li><li>Precision bow arm tracking</li><li>Advanced release timing analysis</li><li>Load/transfer efficiency</li><li>Competitive-level form optimization</li></ul>'
			};

				// helper: adjust tone based on selected mode
				function adjustTone(text){
					const mode = coachState.mode || 'competitive';
					switch(mode){
						case 'beginner':
							return 'üòä ' + text + ' Keep it relaxed and repeat slowly.';
						case 'tournament':
							return 'üîé ' + text + ' Focus on repeatability under pressure.';
						case 'tuning':
							return 'üõ† ' + text + ' Check equipment alignment and measurements.';
						default:
							return 'üí° ' + text;
					}
				}

				// helper: simulated video frame notes
				function makeFrameNotes(focus){
					const notes = [];
					const baseFrame = Math.floor(10 + Math.random()*120);
					if(focus === 'stance'){
						notes.push(`Frame ${baseFrame}: Feet slightly shoulder-width; weight shifted forward.`);
						notes.push(`Frame ${baseFrame+18}: Minor heel lift detected.`);
					} else if(focus === 'draw'){
						notes.push(`Frame ${baseFrame+3}: Draw length consistent.`);
						notes.push(`Frame ${baseFrame+30}: Back tension engaged late.`);
					} else if(focus === 'anchor'){
						notes.push(`Frame ${baseFrame+5}: Anchor point varies ~1cm between shots.`);
					} else if(focus === 'grip'){
						notes.push(`Frame ${baseFrame+4}: Hand position steady; minimal torque on the grip.`);
						notes.push(`Frame ${baseFrame+22}: Finger pressure consistent across shots.`);
					} else if(focus === 'bowarm'){
						notes.push(`Frame ${baseFrame+6}: Bow arm extension consistent; elbow locked.`);
						notes.push(`Frame ${baseFrame+28}: Minor bow arm oscillation on follow-through.`);
					} else if(focus === 'release'){
						notes.push(`Frame ${baseFrame+2}: Slight wrist roll on release.`);
						notes.push(`Frame ${baseFrame+25}: Follow-through begins correctly.`);
					} else if(focus === 'follow') {
						notes.push(`Frame ${baseFrame+10}: Smooth follow-through observed.`);
					} else {
						notes.push(`Frame ${baseFrame+10}: General form looks stable.`);
					}
					return notes;
				}
			
			const cameraInstructions = {
				'stance': 'üì∑ Position camera 10-15 feet away at ground level, angled slightly upward to capture full body posture. Ensure feet and hip alignment are visible.',
				'draw': 'üì∑ Place camera at 45¬∞ angle to the side, 5-10 feet away. Focus on back tension and shoulder rotation during the draw phase.',
				'anchor': 'üì∑ Position camera directly in front or to the side at eye level. Capture face and anchor point clearly for consistency analysis.',
				'release': 'üì∑ Use side angle at 45¬∞, close enough to see hand and string release. Ensure lighting highlights the release moment.',
				'follow': 'üì∑ Camera at side angle, following the bow arm movement post-release. Keep focus on bow arm and follow-through position.'
			};
			
			mdl.innerHTML = `<div class="modal fade" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">üì∏ Form Analysis - ${expLevel} (${coachState.formFocus.charAt(0).toUpperCase() + coachState.formFocus.slice(1)})</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p><strong>Analysis will evaluate:</strong></p>${analysis[coachState.experienceLevel]}<p class="text-muted mt-3"><strong>Camera Positioning:</strong><br/>${cameraInstructions[coachState.formFocus]}</p></div><div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Close</button><button id="startRecordingBtn" class="btn btn-primary">Analyze Sample</button></div></div></div></div>`;
			document.body.appendChild(mdl);
			const bsModal = new bootstrap.Modal(mdl.querySelector('.modal'));
			bsModal.show();
			// remove loading overlay
			const existingLoader = document.getElementById('analysisLoader');
			if(existingLoader) existingLoader.remove();
			// hook up button to show analysis
			const startBtn = mdl.querySelector('#startRecordingBtn');
				if(startBtn){
					startBtn.addEventListener('click', ()=>{
						bsModal.hide();

						// generate fake per-aspect scores influenced by experience level and focus
						const aspects = ['Stance','Draw','Anchor','Release','Follow-through','Grip','Bow Arm'];
						const baseByLevel = { beginner:55, intermediate:72, advanced:86 };
						const base = baseByLevel[coachState.experienceLevel] || 70;
						const scores = {};
						aspects.forEach(a => {
							// small boost for currently selected focus (normalize names)
							const normA = a.toLowerCase().replace(/[^a-z0-9]/g,'');
							const normFocus = (coachState.formFocus||'').toLowerCase().replace(/[^a-z0-9]/g,'');
							const focusBoost = (normA.includes(normFocus) && normFocus) ? 6 + Math.round(Math.random()*4) : 0;
							const randomVariance = Math.round((Math.random()-0.4) * 18); // skew slightly positive
							let s = base + randomVariance + focusBoost + Math.round((Math.random()-0.5)*8);
							s = Math.max(25, Math.min(99, s));
							scores[a] = s;
						});
						const overall = Math.round(Object.values(scores).reduce((a,b)=>a+b,0)/aspects.length);

						// build scores HTML (simple list + progress bars)
						let scoresHtml = '<h6>Form Scores</h6>';
						scoresHtml += '<div class="mb-2">';
						aspects.forEach(a=>{
							const v = scores[a];
							scoresHtml += `<div style="margin-bottom:6px"><div class="d-flex justify-content-between"><small>${a}</small><small><strong>${v}</strong></small></div><div class="progress" style="height:8px;"><div class="progress-bar" role="progressbar" style="width:${v}%" aria-valuenow="${v}" aria-valuemin="0" aria-valuemax="100"></div></div></div>`;
						});
						scoresHtml += `<div style="margin-top:.75rem"><strong>Overall:</strong> ${overall}</div>`;
						scoresHtml += '</div>';

						// show analysis modal with image, feedback and scores
						const analysis = document.createElement('div');
						analysis.innerHTML = `<div class="modal fade" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header bg-success text-white"><h5 class="modal-title">‚úÖ Analysis Complete - ${expLevel} Level (${coachState.formFocus.charAt(0).toUpperCase() + coachState.formFocus.slice(1)})</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="row"><div class="col-md-6"><h6>Sample Form Image</h6><img src="${randomImage}" alt="Form Analysis" style="max-width:100%;border-radius:8px;border:2px solid #28a745;"></div><div class="col-md-6"><h6>AI Coach Feedback</h6><div class="alert alert-info"><p style="margin:0;"><strong>üí° Analysis Result:</strong></p><p style="margin:0.5rem 0 0 0;">${randomFeedback}</p></div><div class="alert alert-light"><strong>Recommendations:</strong><ul><li>Maintain this form consistency across all shots</li><li>Practice this technique in varied conditions</li><li>Record more sessions to track improvement</li></ul></div>${scoresHtml}</div></div></div><div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Close</button><button id="saveAnalysisBtn" class="btn btn-success">Save to Session</button></div></div></div></div>`;
						// add simulated frame notes and optional competition note
						const frameNotes = makeFrameNotes(coachState.formFocus);
						let frameHtml = '<div class="mt-3"><strong>Frame Feedback</strong><ul class="small text-muted">';
						frameNotes.forEach(n=> frameHtml += `<li>${n}</li>`);
						frameHtml += '</ul></div>';
						const competitionNote = '<div class="mt-2 small text-muted">Note: Analysis uses simulated computer-vision markers to estimate joint angles and shot sequencing.</div>';
						// inject frame notes and competition note into modal
						analysis.innerHTML = analysis.innerHTML.replace('${scoresHtml}', `${scoresHtml}${frameHtml}${competitionNote}`);
						document.body.appendChild(analysis);
						const bsAnalysis = new bootstrap.Modal(analysis.querySelector('.modal'));
						bsAnalysis.show();

						// append stance report + frame notes into the right column, with a toggle for frame analysis
						const cols = analysis.querySelectorAll('.modal-body .row .col-md-6');
						const rightCol = cols && cols[1];
						if(rightCol){
							// stance-specific detailed report
							if(coachState.formFocus === 'stance'){
								const stanceReport = `
									<div class="mt-3">
										<h6>üèπ Stance Evaluation Report</h6>
										<div><strong>Overall Stance Score:</strong> 87 / 100</div>
										<div><strong>Stability Rating:</strong> High</div>
										<div><strong>Consistency Index:</strong> 82%</div>
										<hr/>
										<h6>üìä Technical Breakdown</h6>
										<ul class="small">
											<li><strong>Foot Positioning:</strong> ‚úÖ Optimal<br/>Front foot angled ~30¬∞ outward<br/>Rear foot alignment stable<br/>No heel lift detected</li>
											<li><strong>Weight Distribution:</strong> ‚úÖ Balanced<br/>Estimated 58% front / 42% rear<br/>Minimal lateral sway</li>
											<li><strong>Shoulder Engagement:</strong> ‚úÖ Strong<br/>Scapular engagement maintained<br/>No visible elevation in draw shoulder</li>
										</ul>
										<h6>üéØ Performance Impact</h6>
										<p class="small text-muted">Your current stance provides strong structural stability and supports consistent draw alignment. This foundation is competition-ready at the intermediate level.</p>
										<h6>üöÄ Recommendations for Progression</h6>
										<ul class="small">
											<li>Maintain shoulder tension through full follow-through</li>
											<li>Reduce micro-sway during pre-draw setup</li>
											<li>Track stance consistency over 20+ shot sessions</li>
											<li>Test stability under mild wind conditions</li>
										</ul>
										<h6>üìà Development Focus</h6>
										<p class="small text-muted">To reach Advanced Level Stability, aim for: 90%+ stance consistency across sessions and &lt;3% lateral sway deviation.</p>
									</div>`;
								rightCol.innerHTML += stanceReport;
							}

							// add toggle & frame notes container
							const toggleHtml = `<div class="mt-3"><button id="toggleFrameAnalysis" class="btn btn-sm btn-outline-secondary mb-2">View Frame Analysis</button><div id="frameNotesContainer" style="display:none">${frameHtml}${competitionNote}</div></div>`;
							rightCol.innerHTML += toggleHtml;
							const toggleBtn = analysis.querySelector('#toggleFrameAnalysis');
							const frameContainer = analysis.querySelector('#frameNotesContainer');
							if(toggleBtn && frameContainer){
								toggleBtn.addEventListener('click', ()=>{
									if(frameContainer.style.display === 'none'){
										frameContainer.style.display = 'block';
										toggleBtn.textContent = 'Hide Frame Analysis';
									} else {
										frameContainer.style.display = 'none';
										toggleBtn.textContent = 'View Frame Analysis';
									}
								});
							}
						}

						// save analysis with generated scores into practices when user clicks save
						analysis.querySelector('#saveAnalysisBtn').addEventListener('click', ()=>{
							// build practice record
							const practices = JSON.parse(localStorage.getItem('practices')||'[]');
							const record = {
								id: Date.now(),
								name: `Analysis - ${expLevel} - ${coachState.formFocus}`,
								created: new Date().toISOString(),
								totalScore: overall,
								formScores: scores,
								notes: randomFeedback
							};
							practices.push(record);
							localStorage.setItem('practices', JSON.stringify(practices));
							showFeedback('‚úÖ Analysis saved to current session!');
							bsAnalysis.hide();
						});

						analysis.querySelector('.modal').addEventListener('hidden.bs.modal', ()=> analysis.remove());
					});
				}
			mdl.querySelector('.modal').addEventListener('hidden.bs.modal', ()=> mdl.remove());
		});

		// New Practice Name button: add a practice template
			document.getElementById('newPracticeNameBtn').addEventListener('click', ()=>{
			const name = prompt('New practice/template name:');
			if(!name) return;
			const tpl = { id: Date.now(), name: name, distances: [], weather: 'indoor', equipmentSetupId: null };
			const tpls = JSON.parse(localStorage.getItem('practiceTemplates')||'[]');
			tpls.unshift(tpl);
			localStorage.setItem('practiceTemplates', JSON.stringify(tpls));
			showFeedback('Template saved: ' + name);
		});

		// Create an 'Unidentified Practice' placeholder saved to practices
		document.getElementById('createUnidentifiedBtn').addEventListener('click', ()=>{
			if(!confirm('Create an "Unidentified Practice" placeholder session?')) return;
			const practices = JSON.parse(localStorage.getItem('practices')||'[]');
			const p = { id: Date.now(), name: 'Unidentified Practice', created: new Date().toISOString(), notes: 'Auto-created unidentified practice', totalScore: null };
			practices.push(p);
			localStorage.setItem('practices', JSON.stringify(practices));
			showFeedback('Unidentified Practice created');
		});

		document.getElementById('viewStats').addEventListener('click', ()=>{
			const practices = JSON.parse(localStorage.getItem('practices')||'[]');
			const scored = practices.filter(p=>p.totalScore!=null);
			if(!scored.length){
				showFeedback('No practice sessions recorded yet. Start a session to see stats!');
				return;
			}
			const avgScore = (scored.reduce((a,b)=>a+b.totalScore, 0)/scored.length).toFixed(0);
			const bestScore = Math.max(...scored.map(p=>p.totalScore));
			showFeedback(`Session Stats:<br/>‚Ä¢ Average Score: ${avgScore}<br/>‚Ä¢ Best Score: ${bestScore}<br/>‚Ä¢ Total Sessions: ${scored.length}`);
		});

		document.getElementById('getTips').addEventListener('click', ()=>{
			const tips = [
				'Focus on consistency: Shoot the same routine every time.',
				'Maintain a steady anchor point throughout your draw.',
				'Practice your breathing: Exhale during the release for stability.',
				'Keep your bow arm relaxed and let the string push it away.',
				'Practice distance shooting regularly to build confidence.',
				'Record your sessions to analyze form improvements over time.',
				'Warm up properly before competing or practicing.',
				'Mental preparation is as important as physical technique.',
				'Consistency drills build muscle memory - practice the same distance repeatedly.',
				'Film yourself from different angles to catch form issues early.'
			];
			const tip = tips[Math.floor(Math.random() * tips.length)];
			showFeedback('üí° Tip: ' + tip, true);
		});

			function showFeedback(message, showLoading = false){
				const loadingBar = document.getElementById('loading-bar');
				const display = document.getElementById('feedback-display');
				const content = document.getElementById('feedback-content');
				// apply mode tone if available
				try{ if(coachState && coachState.mode){
					const m = coachState.mode;
					switch(m){
						case 'beginner': message = 'üòä ' + message; break;
						case 'tournament': message = 'üîé ' + message; break;
						case 'tuning': message = 'üõ† ' + message; break;
						default: message = 'üí° ' + message; break;
					}
				}}
				catch(e){}
				content.innerHTML = message;
				if (showLoading) {
					// Show loading bar first
					loadingBar.style.display = 'block';
					setTimeout(() => {
						loadingBar.style.display = 'none';
						// Then show feedback
						display.style.display = 'block';
						setTimeout(()=>{
							display.style.display = 'none';
						}, 5000);
					}, 2000); // 2 seconds for loading animation
				} else {
					// Show feedback immediately
					display.style.display = 'block';
					setTimeout(()=>{
						display.style.display = 'none';
					}, 5000);
				}
			}

		// Initialize on load
		initializeUI();
		
		// Handle collapse icons
		document.querySelectorAll('[data-bs-toggle="collapse"]').forEach(btn => {
			btn.addEventListener('click', function() {
				const icon = this.querySelector('.collapse-icon');
				setTimeout(() => {
					if (this.classList.contains('collapsed')) {
						icon.textContent = '+';
					} else {
						icon.textContent = '‚àí';
					}
				}, 10);
			});

			// Recent sessions renderer
			function renderRecentSessions(){
				const containerId = 'recentSessionsContainer';
				let container = document.getElementById(containerId);
				if(!container){
					const wrap = document.createElement('div');
					wrap.className = 'coach-card card';
					wrap.innerHTML = `<div class="card-header" style="background: linear-gradient(135deg, #334155 0%, #1f2937 100%); color: white;"><strong>üìà Recent Sessions</strong></div><div class="card-body"><div id="${containerId}"></div></div>`;
					document.querySelector('main.site-main').appendChild(wrap);
					container = document.getElementById(containerId);
				}
				const practices = JSON.parse(localStorage.getItem('practices')||'[]');
				const sorted = practices.slice().sort((a,b)=> new Date(b.created) - new Date(a.created)).slice(0,5);
				if(!sorted.length){ container.innerHTML = '<div class="text-muted">No recent sessions yet.</div>'; return; }
				let html = '<ul class="list-group">';
				sorted.forEach(s=>{ const date = s.created? new Date(s.created).toLocaleString() : ''; const score = s.totalScore!=null? s.totalScore : (s.formScores? Math.round(Object.values(s.formScores).reduce((a,b)=>a+b,0)/Object.keys(s.formScores).length) : '‚Äî'); html += `<li class="list-group-item d-flex justify-content-between align-items-center"><div><strong>${s.name}</strong><div class="small text-muted">${date}</div></div><span class="badge bg-primary rounded-pill">${score}</span></li>`; });
				html += '</ul>';
				container.innerHTML = html;
			}

			// Mode button handlers
			document.getElementById('modeBeginner').addEventListener('click', ()=>{ coachState.mode='beginner'; ['modeBeginner','modeCompetitive','modeTournament','modeTuning'].forEach(id=>document.getElementById(id).classList.remove('active')); document.getElementById('modeBeginner').classList.add('active'); saveState(); showFeedback('Mode set to Beginner'); });
			document.getElementById('modeCompetitive').addEventListener('click', ()=>{ coachState.mode='competitive'; ['modeBeginner','modeCompetitive','modeTournament','modeTuning'].forEach(id=>document.getElementById(id).classList.remove('active')); document.getElementById('modeCompetitive').classList.add('active'); saveState(); showFeedback('Mode set to Competitive'); });
			document.getElementById('modeTournament').addEventListener('click', ()=>{ coachState.mode='tournament'; ['modeBeginner','modeCompetitive','modeTournament','modeTuning'].forEach(id=>document.getElementById(id).classList.remove('active')); document.getElementById('modeTournament').classList.add('active'); saveState(); showFeedback('Mode set to Tournament Prep'); });
			document.getElementById('modeTuning').addEventListener('click', ()=>{ coachState.mode='tuning'; ['modeBeginner','modeCompetitive','modeTournament','modeTuning'].forEach(id=>document.getElementById(id).classList.remove('active')); document.getElementById('modeTuning').classList.add('active'); saveState(); showFeedback('Mode set to Equipment Tuning'); });
		});
	})();
	</script>
	<script>
		// Catch unhandled button clicks and show error
		document.addEventListener('click', (e) => {
			const btn = e.target.closest('button:not([data-bs-dismiss])'); 
			if(!btn) return;
			if(btn.onclick || btn.getAttribute('onclick')) return;
			if(btn.getAttribute('data-bs-toggle')) return; // Bootstrap toggles
			if(!btn.id && !btn.getAttribute('data-action')) {
				e.preventDefault();
				alert('This feature is not yet implemented.');
			}
		});
	</script>
</body>
</html>